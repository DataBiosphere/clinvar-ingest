apiVersion: argoproj.io/v1alpha1
kind: CronWorkflow
metadata:
  name: dual-writer-clinvar-ingest
spec:
  suspend: {{ not .Values.cron.enable }}
  schedule: {{ .Values.cron.schedule | quote }}
  timezone: {{ .Values.cron.timezone | quote }}
  concurrencyPolicy: Forbid
  workflowSpec:
    entrypoint: main
    serviceAccountName: {{ .Values.serviceAccount.k8sName }}
    podGC:
      strategy: OnWorkflowSuccess
  #  onExit: {{ if .Values.notification.onlyOnFailure }}send-slack-notification-if-failed{{ else }}send-slack-notification{{ end }}
    templates:
    - name: main
      steps:
        - - name: run-main-template
            templateRef:
              name: ingest-clinvar-release-e2e
              template: main
            arguments:
              parameters:
                - name: archive-path
                  value: weekly_release/ClinVarVariationRelease_00-latest_weekly.xml.gz
                - name: gcs-prefix
                  value: {{ include "argo.timestamp" . | quote }}